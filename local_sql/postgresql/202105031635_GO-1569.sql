/**********************************************************************************************************/
-- Update default roles functionality
/**********************************************************************************************************/
-- Remove all included roles and document action access for all current default roles
DELETE FROM bh_defaultincludedrole;
DELETE FROM bh_default_docaction_access;

-- Update the current default roles to have the correct included role assignment (default document action access isn't needed)
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT currentnext FROM ad_sequence WHERE lower(name) = 'bh_defaultincludedrole'), 0, 0, 'aba702e6-7ed5-4c12-9908-afd4221d84ff', '2021-05-03 16:39:23.161000', 100, null, 'Y', null, '2021-05-03 16:39:23.161000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='461b31c5-cae2-449d-8a0c-7385b12f4685'), 'B') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '8535a681-2dcd-4826-bd5d-98fc70c160ed', '2021-05-03 16:39:34.321000', 100, null, 'Y', null, '2021-05-03 16:39:34.321000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='98617c31-55ff-48f9-bd44-253ef323d960'), 'C') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '2a5c3d7b-9884-4f0f-aedc-1bd379241b8b', '2021-05-03 16:39:43.679000', 100, null, 'Y', null, '2021-05-03 16:39:43.679000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='ec17fee0-a53a-4dbb-b946-423ce14880eb'), 'I') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '5062439a-f717-4744-aacb-f043e3dda36b', '2021-05-03 16:39:52.455000', 100, null, 'Y', null, '2021-05-03 16:39:52.455000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='097feff0-3aa6-41fe-bf76-936b03859846'), 'L') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, 'd8c5188f-479e-4816-a490-eef982bf51ec', '2021-05-03 16:40:01.517000', 100, null, 'Y', null, '2021-05-03 16:40:01.517000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='09eb7fc8-9cc5-44b0-9d14-15258a066038'), 'R') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '1daa5eaa-904c-4adb-bb94-d7b30dfe0f1a', '2021-05-03 16:40:25.201000', 100, null, 'Y', null, '2021-05-03 16:40:25.201000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='93365778-a2d9-433b-b962-87fb150db4fa'), 'X') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '13a25f93-823c-464d-b65c-881f315d7fc6', '2021-05-03 17:09:15.056000', 100, null, 'Y', null, '2021-05-03 17:09:15.056000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='baec9412-d994-4313-815c-31332357863a'), 'B') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '1f8640a6-4c04-4cc0-b379-9d16dc503b52', '2021-05-03 17:09:25.693000', 100, null, 'Y', null, '2021-05-03 17:09:25.693000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='baec9412-d994-4313-815c-31332357863a'), 'C') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '46cf9dd4-1ec9-4d84-af17-2d941bee1995', '2021-05-03 17:09:35.390000', 100, null, 'Y', null, '2021-05-03 17:09:35.390000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='baec9412-d994-4313-815c-31332357863a'), 'I') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '7a9840aa-f79c-4d53-9f91-525e8865d69e', '2021-05-03 17:09:47.780000', 100, null, 'Y', null, '2021-05-03 17:09:47.780000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='baec9412-d994-4313-815c-31332357863a'), 'L') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '0927e9f3-692e-402d-b826-a96f7f20e16c', '2021-05-03 17:09:58.860000', 100, null, 'Y', null, '2021-05-03 17:09:58.860000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='baec9412-d994-4313-815c-31332357863a'), 'R') ON CONFLICT DO NOTHING;
INSERT INTO bh_defaultincludedrole (bh_defaultincludedrole_id, ad_client_id, ad_org_id, bh_defaultincludedrole_uu, created, createdby, description, isactive, name, updated, updatedby, included_role_id, db_usertype) VALUES ((SELECT MAX(bh_defaultincludedrole_id) + 1 FROM bh_defaultincludedrole), 0, 0, '26f93037-ffc8-4d35-8f53-97833f13b364', '2021-05-03 17:10:16.376000', 100, null, 'Y', null, '2021-05-03 17:10:16.376000', 100, (SELECT ad_role_id FROM ad_role WHERE ad_role_uu='baec9412-d994-4313-815c-31332357863a'), 'X') ON CONFLICT DO NOTHING;

-- Update all report access to be read/write so reports can be run
UPDATE ad_process_access SET isreadwrite = 'Y'
WHERE ad_role_id IN (SELECT ad_role_id FROM ad_role WHERE ad_role_uu IN ('93365778-a2d9-433b-b962-87fb150db4fa','09eb7fc8-9cc5-44b0-9d14-15258a066038','461b31c5-cae2-449d-8a0c-7385b12f4685','98617c31-55ff-48f9-bd44-253ef323d960','ec17fee0-a53a-4dbb-b946-423ce14880eb','097feff0-3aa6-41fe-bf76-936b03859846'));

-- Update the donor fund report to be the correct one assigned
UPDATE ad_process_access SET ad_process_id = (SELECT ad_process_id FROM ad_process WHERE ad_process_uu = 'ad3da529-459a-4804-8020-5f192360fed0')
WHERE ad_process_id = (SELECT ad_process_id FROM ad_process WHERE ad_process_uu = '3478d341-c6d9-4f52-a865-5bf0ba8a7607')
	AND ad_role_id IN (SELECT ad_role_id FROM ad_role WHERE ad_role_uu IN ('93365778-a2d9-433b-b962-87fb150db4fa','09eb7fc8-9cc5-44b0-9d14-15258a066038','461b31c5-cae2-449d-8a0c-7385b12f4685','98617c31-55ff-48f9-bd44-253ef323d960','ec17fee0-a53a-4dbb-b946-423ce14880eb','097feff0-3aa6-41fe-bf76-936b03859846'));

-- Add a report button for the "Stock to be Ordered" report so it can show up in the UI
INSERT INTO bh_dbrdbtngrp_btn (bh_dbrdbtngrp_btn_id, ad_client_id, ad_infowindow_id, ad_org_id, ad_window_id, bh_dbrdbtngrp_btn_uu, buttonclassname, buttonhelptext, buttontext, created, createdby, description, iconclassname, isactive, lineno, name, updated, updatedby, bh_dbrdbtngrp_id, ad_process_id, ad_form_id, included_role_id) VALUES ((SELECT MAX(bh_dbrdbtngrp_btn_id) + 1 FROM bh_dbrdbtngrp_btn), 0, null, 0, null, '7f3c4250-0014-4c31-a760-52190ca4af90', 'button app big', null, null, '2021-05-04 15:27:26.615000', 100, 'Stock to be Ordered', null, 'Y', 0, 'Stock to be Ordered', '2021-05-04 15:27:26.615000', 100, (SELECT bh_dbrdbtngrp_id FROM bh_dbrdbtngrp WHERE bh_dbrdbtngrp_uu = '9b44ce0e-3113-4690-ad0b-92b95b34c741'), (SELECT ad_process_id FROM ad_process WHERE ad_process_uu = '03ba009a-68bb-4b12-a5bc-e58a9bce1545'), null, null) ON CONFLICT DO NOTHING;

-- Add a report button for the "Diagnosis Report" report so it can show up in the UI
INSERT INTO bh_dbrdbtngrp_btn (bh_dbrdbtngrp_btn_id, ad_client_id, ad_infowindow_id, ad_org_id, ad_window_id, bh_dbrdbtngrp_btn_uu, buttonclassname, buttonhelptext, buttontext, created, createdby, description, iconclassname, isactive, lineno, name, updated, updatedby, bh_dbrdbtngrp_id, ad_process_id, ad_form_id, included_role_id) VALUES ((SELECT MAX(bh_dbrdbtngrp_btn_id) + 1 FROM bh_dbrdbtngrp_btn), 0, null, 0, null, '62100873-9fea-465b-b730-87fe0b3e2c65', 'button app big', null, null, '2021-05-04 15:46:48.084000', 100, 'Diagnosis Report', null, 'Y', 0, 'Diagnosis Report', '2021-05-04 15:46:48.084000', 100, (SELECT bh_dbrdbtngrp_id FROM bh_dbrdbtngrp WHERE bh_dbrdbtngrp_uu = '9b44ce0e-3113-4690-ad0b-92b95b34c741'), (SELECT ad_process_id FROM ad_process WHERE ad_process_uu = '7c29028a-8dd3-4025-a5af-87701748d81f'), null, null) ON CONFLICT DO NOTHING;

SELECT register_migration_script('202105031635_GO-1569.sql') FROM dual;
