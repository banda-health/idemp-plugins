<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.8.0.final using JasperReports Library version 6.8.0-2ed8dfabb690ff337a5797129f2cd92902b0c87b  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="705Referral" pageWidth="900" pageHeight="595" orientation="Landscape" columnWidth="860" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" isIgnorePagination="true" uuid="dba8eeb0-240c-4b61-b886-59a1f057598d">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="LocalDB Adapter"/>
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<style name="Crosstab_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<subDataset name="Dataset1" uuid="21d1918a-034e-48f0-8205-9998126ad69b">
		<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
		<property name="com.jaspersoft.studio.data.defaultdataadapter" value="LocalDB Adapter"/>
		<queryString language="SQL">
			<![CDATA[WITH date_limitter AS (
    SELECT generate_series(date('2021-05-01'), date('2021-05-31'), '1d')::date AS calendar
),
     referral_list AS (
         SELECT DISTINCT value as Referral
         FROM ad_ref_list
                  JOIN c_order Referraltype ON value = Referraltype.bh_referral
                  RIGHT JOIN ad_reference a ON ad_ref_list.ad_reference_id = a.ad_reference_id
         WHERE value is not null
     ),
     referral_count AS (
         SELECT DISTINCT  bh_moh705b_greaterthan5,
                         value                       as referral,
                         c.calendar,
                         coalesce(c.noofreferral, 0) as noofreferral
         FROM ad_ref_list b
                  LEFT JOIN (
             SELECT  bh_moh705b_greaterthan5,
                    bh_referral,
                    cast(bh_visitdate as date)         as calendar,
                    COUNT(bh_primarycodeddiagnosis_id) AS noofreferral
             from c_order c
                      JOIN bh_coded_diagnosis cd ON bh_primarycodeddiagnosis_id::numeric = cd.bh_coded_diagnosis_id
                      JOIN date_limitter dl ON dl.calendar = cast(bh_visitdate as date)
             WHERE bh_primarycodeddiagnosis_id IS NOT NULL
             AND bh_moh705b_greaterthan5 NOT IN ('NA', 'COVID-19 - suspected', 'COVID-19 - confirmed', 'Road Traffic Injuries', 'Tonsillitis', 'Diarrhea with some dehydration',
        'Diarrhea with severe dehydration','Other Diseases Of Respiratory System', 'Sexual Assault', 'Kalaazar',
        'Fevers', 'Eye Infections', 'Dracunculiasis (Guinea Worm)', 'Neoplasms', 'Newly Diagnosed HIV',
        'Other Central Nervous System Conditions','Other Convulsive Disorders','Other Eye Conditions',
        'Plague','Diarrhea','Congenital Anomalies', 'Chromosomal Abnormalities (E.G Downs Syndrome; Edwards Syndrome Etc.)',
        'Cerebral Palsy', 'Autism')
             GROUP BY bh_referral, cast(bh_visitdate as date), bh_moh705b_greaterthan5
         ) c ON b.value = c.bh_referral
         ORDER BY b.value
     )
SELECT dali.calendar,
        bh_moh705b_greaterthan5,
       dl.Referral,
       COALESCE(dc.noofreferral, 0) as noofreferral
FROM referral_list dl
         CROSS JOIN date_limitter dali
         LEFT JOIN referral_count dc
                   ON dc.calendar = dali.calendar
                       AND dl.referral = dc.referral
ORDER BY dl.Referral ASC;]]>
		</queryString>
		<field name="calendar" class="java.sql.Date">
			<property name="com.jaspersoft.studio.field.label" value="calendar"/>
		</field>
		<field name="referral" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="referral"/>
			<property name="com.jaspersoft.studio.field.tree.path" value="ad_ref_list"/>
		</field>
		<field name="noofreferral" class="java.lang.Long">
			<property name="com.jaspersoft.studio.field.label" value="noofreferral"/>
		</field>
		<group name="referral">
			<groupExpression><![CDATA[$F{referral}]]></groupExpression>
		</group>
	</subDataset>
	<parameter name="Begin Date" class="java.sql.Date"/>
	<parameter name="End Date" class="java.sql.Date"/>
	<parameter name="AD_CLIENT_ID" class="java.lang.Integer" isForPrompting="false"/>
	<queryString>
		<![CDATA[select
    date(c.bh_visitdate) as calendar,
    patient.name AS name
from c_order c
    inner join bh_coded_diagnosis b ON b.bh_coded_diagnosis_id = c.bh_primarycodeddiagnosis_id
    inner join c_bpartner patient on c.c_bpartner_id = patient.c_bpartner_id
    left join ad_user a ON patient.ad_client_id = a.ad_client_id
    where c.ad_client_id = $P{AD_CLIENT_ID}
    and b.bh_moh705b_greaterthan5 is not null
    and (date(c.bh_visitdate) BETWEEN date($P{Begin Date}) AND date($P{End Date}))
 GROUP BY c.bh_visitdate, patient.name, b.bh_moh705b_greaterthan5]]>
	</queryString>
	<field name="calendar" class="java.sql.Date"/>
	<field name="name" class="java.lang.String"/>
	<summary>
		<band height="101" splitType="Stretch">
			<crosstab>
				<reportElement x="0" y="0" width="880" height="101" uuid="205c4105-21c9-4fb9-ac30-ed398766a60d">
					<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.VerticalRowLayout"/>
					<property name="com.jaspersoft.studio.crosstab.style.header" value="Crosstab_CH"/>
					<property name="com.jaspersoft.studio.crosstab.style.group" value="Crosstab_CG"/>
					<property name="com.jaspersoft.studio.crosstab.style.total" value="Crosstab_CT"/>
					<property name="com.jaspersoft.studio.crosstab.style.detail" value="Crosstab_CD"/>
				</reportElement>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<crosstabDataset>
					<dataset>
						<datasetRun subDataset="Dataset1" uuid="ea279474-89ab-45b4-922c-15a3cf96b85a">
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
					</dataset>
				</crosstabDataset>
				<rowGroup name="referral" width="180" totalPosition="End">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{referral}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab_CH">
							<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.FreeLayout"/>
							<textField>
								<reportElement x="22" y="1" width="158" height="20" uuid="953d1ec0-5418-4ffe-8855-f30da22016b5"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<textFieldExpression><![CDATA[$V{referral}]]></textFieldExpression>
							</textField>
							<textField>
								<reportElement mode="Opaque" x="1" y="1" width="20" height="20" forecolor="#000000" backcolor="#FFFFFF" uuid="febd98f2-c136-40f3-80be-63f6ea8450ac"/>
								<box>
									<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
									<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<textFieldExpression><![CDATA[$V{ROW_COUNT}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab_CT">
							<staticText>
								<reportElement x="0" y="0" width="180" height="20" forecolor="#FFFFFF" uuid="be4efc8e-8e7a-4aaf-b144-d458b32ec028"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font isBold="true"/>
								</textElement>
								<text><![CDATA[Total referral]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="calendar" height="20" totalPosition="End">
					<bucket class="java.sql.Date">
						<bucketExpression><![CDATA[$F{calendar}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Opaque" style="Crosstab_CH">
							<textField>
								<reportElement x="0" y="0" width="20" height="20" uuid="14eb1ce9-9850-40f3-b31b-e5b8618c6384"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[DAY($V{calendar})]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents mode="Opaque" style="Crosstab_CT">
							<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.FreeLayout"/>
							<staticText>
								<reportElement x="0" y="0" width="41" height="20" forecolor="#FFFFFF" uuid="b94439be-84f4-48f9-99ce-8d8f9aa2a690">
									<property name="com.jaspersoft.studio.unit.width" value="px"/>
								</reportElement>
								<box>
									<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#FFFFFF"/>
									<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#FFFFFF"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font isBold="true"/>
								</textElement>
								<text><![CDATA[Total calendar]]></text>
							</staticText>
							<staticText>
								<reportElement mode="Opaque" x="41" y="1" width="19" height="19" uuid="f8522037-8690-48bb-88c8-892a9db34df1"/>
								<box>
									<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								</box>
								<text><![CDATA[]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="noofreferral_MEASURE" class="java.lang.Long" calculation="Sum">
					<measureExpression><![CDATA[$F{noofreferral}]]></measureExpression>
				</measure>
				<crosstabCell width="20" height="21">
					<cellContents mode="Opaque" style="Crosstab_CD">
						<textField>
							<reportElement mode="Opaque" x="0" y="0" width="20" height="21" uuid="e886b28a-6bc4-4d4f-9bf6-d3e7d03282e7"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{noofreferral_MEASURE}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="60" height="21" columnTotalGroup="calendar">
					<cellContents mode="Opaque" style="Crosstab_CT">
						<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.FreeLayout"/>
						<textField>
							<reportElement x="0" y="0" width="41" height="21" forecolor="#FFFFFF" uuid="a5287709-d0ce-4747-8ef6-d0e483e4a668"/>
							<box>
								<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#FFFFFF"/>
								<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#FFFFFF"/>
							</box>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{noofreferral_MEASURE}]]></textFieldExpression>
						</textField>
						<textField>
							<reportElement mode="Opaque" x="41" y="0" width="19" height="21" uuid="0685cdfc-6400-4a5d-9226-ae11518a62e6"/>
							<box>
								<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{ROW_COUNT}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="20" height="20" rowTotalGroup="referral">
					<cellContents mode="Opaque" style="Crosstab_CT">
						<textField>
							<reportElement x="0" y="0" width="20" height="20" forecolor="#FFFFFF" uuid="e7d51036-b7c2-4cd3-8805-4510fa3d6032"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{noofreferral_MEASURE}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="60" height="20" rowTotalGroup="referral" columnTotalGroup="calendar">
					<cellContents mode="Opaque" style="Crosstab_CT">
						<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.FreeLayout"/>
						<textField>
							<reportElement x="0" y="0" width="41" height="20" forecolor="#FFFFFF" uuid="da50a729-5a4f-4538-863c-139fab17de50"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{noofreferral_MEASURE}]]></textFieldExpression>
						</textField>
						<staticText>
							<reportElement mode="Opaque" x="41" y="1" width="19" height="19" uuid="39df2d5c-a20d-4a22-a522-8c5f18d798cd"/>
							<box>
								<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<text><![CDATA[]]></text>
						</staticText>
					</cellContents>
				</crosstabCell>
			</crosstab>
			<textField>
				<reportElement x="0" y="0" width="180" height="20" uuid="693a702e-74b7-4dff-a1b6-189c6d1d163c"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Referrals"]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
